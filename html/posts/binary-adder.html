{% extends "base.html" %}

{% block internal_stylesheet %}
<style>
        .physical-project-simulator-grid {
        display:grid;
        justify-items: center;
        grid-template-columns: 2fr 1fr 2fr;
        grid-template-rows: auto;
        row-gap: 2px;
        grid-template-areas: 
            "a      led-a decimal-a"
            "plus   .     .        "
            "b      led-b decimal-b"
            "equals .     .        "
            "c      led-c decimal-c";
        max-height: 100%;
        border: 2px solid;
        border-radius: 10px;
        padding: 4px;
    }

    @media screen and (min-width: 480px) {
    .physical-project-simulator-grid {
        display:grid;
        justify-items: center;
        align-items: center;
        grid-template-columns: 1fr 1fr 1fr 1fr 1fr;
        grid-template-rows: auto;
        row-gap: 2px;
        grid-template-areas: 
            "a plus b equals c"
            "led-a . led-b . led-c"
            "decimal-a . decimal-b . decimal-c";
        max-height: 100%;
        border: 2px solid;
        border-radius: 10px;
        padding: 4px;
    }
    }

    .item-a {
        grid-area: a;
    }
    .item-plus {
        grid-area: plus;
    }
    .item-b {
        grid-area: b;
    }
    .item-equals {
        grid-area: equals;
    }
    .item-c {
        grid-area: c
    }
    .item-led-a {
        grid-area: led-a;
        justify-self: end;
    }
    .item-led-b {
        grid-area: led-b;
        justify-self: end;
    }
    .item-led-c {
        grid-area: led-c;
        justify-self: end;
    }
    .item-decimal-a {
        grid-area: decimal-a;
    }
    .item-decimal-b {
        grid-area: decimal-b;
    }
    .item-decimal-c {
        grid-area: decimal-c;
    }

    .input-a-leds {
        width: 4em;
        display: grid;
        grid-template-columns: 1em 1em 1em 1em;
        justify-content: center;
    }
    .input-b-leds {
        width: 4em;
        display: grid;
        grid-template-columns: 1em 1em 1em 1em;
        justify-content: center;
    }
    .output-c-leds {
        width: 5em;
        display: grid;
        grid-template-columns: 1em 1em 1em 1em 1em;
        justify-content: center;
        align-self: center    }

    input[type="checkbox"] {
        -webkit-appearance: none;
        appearance: none;
        background-color: #fff;
        margin: 0;
        display: grid;
        place-content: center;
    }

    input[type="checkbox"]::before {
        content: "";
        width: 1em;
        height: 1em;
        border-radius: 50%;
        transition: box-shadow 200ms ease;
    }

    .input-a-leds input[type="checkbox"]::before {
        box-shadow: inset 1em 1em #330000;
    }

    .input-a-leds input[type="checkbox"]:checked::before {
        box-shadow: inset 1em 1em #FF0000;
    }

    .input-b-leds input[type="checkbox"]::before {
        box-shadow: inset 1em 1em #332B00;
    }

    .input-b-leds input[type="checkbox"]:checked::before {
        box-shadow: inset 1em 1em #FFB000;
    }

    .output-c-leds input[type="checkbox"]::before {
        box-shadow: inset 1em 1em #000033;
    }

    .output-c-leds input[type="checkbox"]:checked::before {
        box-shadow: inset 1em 1em #0073E6;
    }
</style>
{% endblock internal_stylesheet %}

{% block internal_js %}
<script>
    class View {
        constructor() {
            this.outputLeds = document
                .querySelector('.output-c-leds')
                .querySelectorAll('input[type="checkbox"]')
            this.decimalADisplay = document.querySelector('.item-decimal-a')
            this.decimalBDisplay = document.querySelector('.item-decimal-b')
            this.decimalCDisplay = document.querySelector('.item-decimal-c')
        }
        
        updateView(aLeds, bLeds) {
            const aDecimalValue = Array.from(aLeds).reduce((sum, checkbox, index) => {
                return checkbox.checked ? sum + (2 ** (3 - index)) : sum
            }, 0)

            const bDecimalValue = Array.from(bLeds).reduce((sum, checkbox, index) => {
                return checkbox.checked ? sum + (2 ** (3 - index)) : sum
            }, 0)
            
            const aBinaryString = aDecimalValue.toString(2).padStart(4, '0')
            const bBinaryString = bDecimalValue.toString(2).padStart(4, '0')

            const cDecimalValue = aDecimalValue + bDecimalValue
            const cBinaryString = cDecimalValue.toString(2).padStart(5, '0')

            this.decimalADisplay.textContent = aDecimalValue
            this.decimalBDisplay.textContent = bDecimalValue
            this.decimalCDisplay.textContent = cDecimalValue

            Array.from(this.outputLeds).map((led, index) => {
                this.outputLeds[index].checked = cBinaryString[index] === "1"
            })
        }
    }

    const view = new View()

    const aLedsForm = document.querySelector('.input-a-leds');
    const aLeds = aLedsForm.querySelectorAll('input[type="checkbox"]')
    const bLedsForm = document.querySelector('.input-b-leds');
    const bLeds = bLedsForm.querySelectorAll('input[type="checkbox"]')

    aLedsForm.addEventListener('change', _ => {
        view.updateView(aLeds, bLeds)
    })
    bLedsForm.addEventListener('change', _ => {
        view.updateView(aLeds, bLeds)
    })
</script>
{% endblock internal_js %}

{% block content %}
    <div class="main-container">
        <h1 class="page-heading bottom-padding-05">Making a binary adder toy with scrap wood</h1>
        <p class="meta-info bottom-padding-15">October 8, 2023</p>
        <div class="blog-content">
            <div class="physical-project-simulator-grid">
                <!-- css grid items -->
                <div class="item-a">a</div>  
                <div class="item-plus">+</div>
                <div class="item-b">b</div>
                <div class="item-equals">=</div>
                <div class="item-c">c</div>
                <form class="item-led-a input-a-leds">
                    <input type="checkbox">
                    <input type="checkbox">
                    <input type="checkbox">
                    <input type="checkbox">
                </form>
                <form class="item-led-b input-b-leds">
                    <input type="checkbox">
                    <input type="checkbox">
                    <input type="checkbox">
                    <input type="checkbox">
                </form>
                <form class="item-led-c output-c-leds">
                    <input type="checkbox" disabled>
                    <input type="checkbox" disabled>
                    <input type="checkbox" disabled>
                    <input type="checkbox" disabled>
                    <input type="checkbox" disabled>
                </form>
                <div class="item-decimal-a">0</div>
                <div class="item-decimal-b">0</div>
                <div class="item-decimal-c">0</div>
            </div>
            <p>
                My niece has a toy that I constantly find myself playing with when I visit. It's a simple wooden box with some switches and LEDs on the front. Electronics wise, the switches are just wired to toggle certain LEDs but it's very fun to fiddle with and I find the overall design with the wooden enclosure very satisfying. For a long time I thought it would be cool to make something with a similar wooden enclosure that does something a bit more involved. This fall, I finally got around to following through with this idea and made something in the same spirit as my nieces toy except the LEDs and switches are connected to a binary adder. 
            </p>
            <p>
                I made it with a scrap piece of wood from my yard and a 74LS83 chip. The chip has all the logic for adding two binary numbers in a nice little breadboard friendly package. 
            </p>
            <figure>
                <img src="/images/posts/binary-adder/finished.jpeg"
                     alt="A wooden box with a row of thirteen coloured LEDs at the top and a row of eight switches at the bottom"
                     loading="lazy" 
                     class="blog-photo"
                />
                <figcaption>The finished project</figcaption>
            </figure>
            <h2 class="page-subheading">How it works</h2>
            <p>
                The top row of LEDs is divided into three numbers. Starting from the left, the first four LEDs are red and represent the first number to be added. The next four LEDs are yellow and represent the second number to be added. The next five LEDs are blue and represent the resulting sum. The bottom row of switches control the numbers to be added, so the first four switches from the left control the red LEDs, and the next four switches control the yellow LEDs.
            </p>
            <p>
                Let's look at some examples.
            </p>
            <p>
                The following image shows the adder set to 1 + 1. In binary this is 0001 + 0001 = 00010, the LEDs that are on represent 1's and the LEDs that are off represent 0's.
            </p>
            <figure>
                <img src="/images/posts/binary-adder/example1.jpeg"
                     alt="The LEDs showing the addition of 1 + 1"
                     loading="lazy"
                     class="blog-photo"
                />
                <figcaption>1 + 1 = 2</figcaption>
            </figure>
            <p>
                The following image shows the addtion of 7 + 3 or 0111 + 0011 = 01010 in binary.
            </p>
            <figure>
                <img src="/images/posts/binary-adder/example2.jpeg"
                     alt="The LEDs showing the addition of 1 + 1"
                     loading="lazy"
                     class="blog-photo"
                />
                <figcaption>7 + 3 = 10</figcaption>
            </figure>
            <p>
                The final example shows the fifth bit of the sum being used. This illustrates how you need five bits to add two four-bit numbers together due to overflow.
            </p>
            <figure>
                <img src="/images/posts/binary-adder/example3.jpeg"
                        alt="The LEDs showing the addition of 1 + 1"
                        loading="lazy"
                        class="blog-photo"
                />
                <figcaption>1 + 15 = 16</figcaption>
            </figure>
            <h2 class="page-subheading">Making it</h2>
            <p>
                The circuit is straightfoward, I followed the <a href="/resources/7483.pdf">data sheet</a> for the 74LS83 chip to connect LEDs to the inputs and outputs. Then I added switches to control the inputs. The circuit is powered with a mini-USB breakout board. The breadboard circuit is what is used in the enclosure because I estimated it would be small enough to fit and I didn't want to go through the trouble of soldering a protytype board.
            </p>
            <figure>
                <img src="/images/posts/binary-adder/circuit.jpeg"
                        alt="Breadboard circuit for the adder"
                        loading="lazy"
                        class="blog-photo"
                />
                <figcaption>The breadboard circuit</figcaption>
            </figure>
            <p>
                For the enclosure I took a scrap piece of 2x6 from the backyard, cut off a portion for the back, and hollowed it out with a drill press.
            </p>
            <figure>
                <img src="/images/posts/binary-adder/hollowing.jpeg"
                        alt="A piece of wood being hollowed with drill press"
                        loading="lazy"
                        class="blog-photo"
                />
                <figcaption>Starting to hollow the enclosure</figcaption>
            </figure>
            <figure>
                <img src="/images/posts/binary-adder/hollowed.jpeg"
                        alt="A hollowed out 2x6 piece of wood"
                        loading="lazy"
                        class="blog-photo"
                />
                <figcaption>The hollowed out enclosure</figcaption>
            </figure>
            <p>
                Then holes were drilled for the LEDs and switches on the front. A hole was drilled into the side for a power switch and another hole was drilled into the back for the usb connector. 
            </p>
            <figure>
                <img src="/images/posts/binary-adder/holes.jpeg"
                        alt="Holes drilled into the enclosure"
                        loading="lazy"
                        class="blog-photo"
                />
                <figcaption>Drill holes</figcaption>
            </figure>
            <p>
                After some sanding and a thin coat of finish, it's ready to be assembled.
            </p>
            <figure>
                <img src="/images/posts/binary-adder/ready-to-assemble.jpeg"
                        alt="Sanded and finished enclosure"
                        loading="lazy"
                        class="blog-photo"
                />
                <figcaption>Sanded and ready for assembling</figcaption>
            </figure>
            <p>
                Then it was just a matter of mounting the LEDs and switches. Panel mount LED holders made this a breeze. 
            </p>
            <figure>
                <img src="/images/posts/binary-adder/testing.jpeg"
                        alt="Showing the inside of the enclosure with the ciruit inside"
                        loading="lazy"
                        class="blog-photo"
                />
                <figcaption>Assembling</figcaption>
            </figure>
            <h2 class="page-subheading">Conclusion</h2>
            <p>
                Being a software developper, it's fun to show off a physical project to people. Originally, I wanted it to be battery powered like my nieces toy but space inside the enclosure ended up being too tight so I stuck with the USB connector. This worked out for the best since now I like to have it sitting on my desk turned on as a decoration.
            </p>
            <figure>
                <img src="/images/posts/binary-adder/desk.jpeg"
                        alt="The finished project on a desk"
                        loading="lazy"
                        class="blog-photo"
                />
                <figcaption>This is where it lives now</figcaption>
            </figure>
        </div>
    </div>
{% endblock content %}